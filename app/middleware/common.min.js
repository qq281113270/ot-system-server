import bodyParser from"koa-bodyparser";import cookie from"koa-cookie";import cors from"koa2-cors";import moment from"moment";import{v4 as uuidv4}from"uuid";const getColors=keys=>{const styles={bright:"[1m",grey:"[2m",italic:"[3m",underline:"[4m",reverse:"[7m",hidden:"[8m",black:"[30m",red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m",cyan:"[36m",white:"[37m",blackBG:"[40m",redBG:"[41m",greenBG:"[42m",yellowBG:"[43m",blueBG:"[44m",magentaBG:"[45m",cyanBG:"[46m",whiteBG:"[47m"};let colors="";return"string"==typeof keys?colors=styles[keys]:keys.forEach(key=>{colors+=styles[key]}),colors},linkLog=requestId=>({debug:(...ags)=>{console.debug(`${getColors("blue")}`,`[${moment().format("YYYY-MM-DD HH:mm:ss")}]`,`[request-id:${requestId}]`,"[DEBUG]",...ags)},warn:(...ags)=>{console.warn(`${getColors("yellow")}`,`[${moment().format("YYYY-MM-DD HH:mm:ss")}]`,`[request-id:${requestId}]`,"[WARN]",...ags)},info:(...ags)=>{console.info(`${getColors("green")}`,`[${moment().format("YYYY-MM-DD HH:mm:ss")}]`,`[request-id:${requestId}]`,"[INFO]",...ags)},log:(...ags)=>{console.log(`[${moment().format("YYYY-MM-DD HH:mm:ss")}]`,`[request-id:${requestId}]`,"[LOG]",...ags)},error:(...ags)=>{console.error(`${getColors("red")}`,`[${moment().format("YYYY-MM-DD HH:mm:ss")}]`,`[request-id:${requestId}]`,"[ERROR]",...ags)}}),common=app=>{app.use(bodyParser()),app.use(cookie()),app.use(cors({credentials:!0})),app.use(async(ctx,next)=>{const{request:{header:header},response:response}=ctx,requestId=header["request-id"]||uuidv4();response.append("request-id",requestId),response.console=linkLog(requestId),await next()})};export default common;